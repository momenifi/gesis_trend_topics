<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Hierarchical Topics (LLM)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: #fafafa;
    }
    #chart {
      border: 1px solid #e5e7eb;
      background: #ffffff;
      max-height: 90vh;
      overflow: auto;
    }
    .node circle {
      fill: #4c78a8;
      stroke: #2b4c6f;
      stroke-width: 1px;
    }
    .node text {
      font-size: 12px;
      fill: #1f2933;
    }
    .node .toggle {
      font-size: 12px;
      fill: #fff;
      pointer-events: none;
    }
    .link {
      fill: none;
      stroke: #9fb3c8;
      stroke-width: 1.2px;
    }
  </style>
</head>
<body>
<h2>Hierarchical Topics (LLM Labels)</h2>
<div id="chart"></div>
<script>
const treeData = {"id": "P102", "name": "panel_media_german_machine learning_attitudes (n=1030)", "lines": 3, "tooltip": "", "children": [{"id": "P98", "name": "machine learning_detection_graphs_similarity_named entity (n=311)", "lines": 3, "tooltip": "", "children": [{"id": "P69", "name": "machine learning_nonresponse_architecture_validation_waves (n=42)", "lines": 3, "tooltip": "", "children": [{"id": "T37", "name": "validation, machine learning, annotated, versions, strategies (T37), n=13", "lines": 4, "tooltip": ""}, {"id": "P61", "name": "machine learning_nonresponse_architecture_waves_deep (n=29)", "lines": 3, "tooltip": "", "children": [{"id": "T41", "name": "learning models, entities, task, energy, citizenship (T41), n=13", "lines": 3, "tooltip": ""}, {"id": "T28", "name": "nonresponse, machine learning, panel, waves, time (T28), n=16", "lines": 3, "tooltip": ""}]}]}, {"id": "P94", "name": "detection_graphs_similarity_language models_named entity recognition (n=269)", "lines": 3, "tooltip": "", "children": [{"id": "P92", "name": "similarity_detection_graphs_named entity recognition_language models (n=224)", "lines": 4, "tooltip": "", "children": [{"id": "P58", "name": "graph_network_sentiment_domain_classification (n=42)", "lines": 2, "tooltip": "", "children": [{"id": "T38", "name": "recommendation, graph, named entity recognition, natural language processing, user (T38), n=13", "lines": 5, "tooltip": ""}, {"id": "T7", "name": "graph, networks, label, consistency, family (T7), n=29", "lines": 3, "tooltip": ""}]}, {"id": "P89", "name": "retrieval_knowledge graphs_language models_named entity recognition_benchmark (n=182)", "lines": 5, "tooltip": "", "children": [{"id": "P73", "name": "knowledge graphs_open science_heterogeneous_machine learning_pipeline (n=75)", "lines": 3, "tooltip": "", "children": [{"id": "T6", "name": "similarity, open science, computational social science, package, training (T6), n=32", "lines": 4, "tooltip": ""}, {"id": "P57", "name": "knowledge graphs_heterogeneous_pipeline_artificial intelligence_semantic web (n=43)", "lines": 4, "tooltip": "", "children": [{"id": "T10", "name": "knowledge graphs, semantic web, machine learning, pipeline, argument mining (T10), n=28", "lines": 5, "tooltip": ""}, {"id": "T32", "name": "knowledge graphs, heterogeneous, domain, artificial intelligence, scientific publications (T32), n=15", "lines": 5, "tooltip": ""}]}]}, {"id": "P87", "name": "retrieval_named entity recognition_workshop_llms_large language models (n=107)", "lines": 3, "tooltip": "", "children": [{"id": "P82", "name": "fake_named entity recognition_learning_social media_publishing (n=62)", "lines": 3, "tooltip": "", "children": [{"id": "T42", "name": "workshop, retrieval, event, natural language processing, digital (T42), n=13", "lines": 4, "tooltip": ""}, {"id": "P65", "name": "fake_named entity recognition_media_corpus_deep learning (n=49)", "lines": 3, "tooltip": "", "children": [{"id": "T3", "name": "social media, texts, uncertainty, scientific publications, access (T3), n=35", "lines": 4, "tooltip": ""}, {"id": "T36", "name": "fake, news, named entity recognition, deep learning, machine (T36), n=14", "lines": 4, "tooltip": ""}]}]}, {"id": "P60", "name": "extraction_knowledge graph_user_language models llms_performance (n=45)", "lines": 4, "tooltip": "", "children": [{"id": "T4", "name": "extraction, knowledge graph, language models llms, named entity recognition, performance (T4), n=34", "lines": 5, "tooltip": ""}, {"id": "T46", "name": "language models, training, computer, zero, benchmarks (T46), n=11", "lines": 3, "tooltip": ""}]}]}]}]}, {"id": "P79", "name": "fact checking_discourse_mining_tweets_knowledge graphs (n=45)", "lines": 3, "tooltip": "", "children": [{"id": "T51", "name": "tweets, polarization, argument mining, network, classifier (T51), n=11", "lines": 3, "tooltip": ""}, {"id": "P62", "name": "fact checking_online_tasks_knowledge graphs_landscape (n=34)", "lines": 3, "tooltip": "", "children": [{"id": "T33", "name": "hybrid, journalism, knowledge graphs, multilingual, fact checking (T33), n=15", "lines": 4, "tooltip": ""}, {"id": "T21", "name": "fact checking, tasks, landscape, online, classification (T21), n=19", "lines": 4, "tooltip": ""}]}]}]}]}, {"id": "P101", "name": "panel_germany_attitudes_media_election (n=719)", "lines": 2, "tooltip": "", "children": [{"id": "P100", "name": "german_media_differences_election_pandemic (n=638)", "lines": 2, "tooltip": "", "children": [{"id": "P99", "name": "privacy_democratic_facebook_germany_browsing (n=266)", "lines": 2, "tooltip": "", "children": [{"id": "P85", "name": "identity_elections_migration_germany_public opinion (n=122)", "lines": 2, "tooltip": "", "children": [{"id": "T35", "name": "voting, immigration, media, right wing, individual level (T35), n=14", "lines": 4, "tooltip": ""}, {"id": "P75", "name": "migration_electoral_germany_public opinion_preferences (n=108)", "lines": 3, "tooltip": "", "children": [{"id": "P67", "name": "attitudes_migration_electoral_germany_driven (n=97)", "lines": 2, "tooltip": "", "children": [{"id": "T15", "name": "public opinion, driven, ads, privacy, cross national (T15), n=22", "lines": 3, "tooltip": ""}, {"id": "P54", "name": "migration_germany_preferences_ideology_voting behavior (n=75)", "lines": 2, "tooltip": "", "children": [{"id": "T5", "name": "populist, party, voting behavior, right wing, personality traits (T5), n=33", "lines": 4, "tooltip": ""}, {"id": "T0", "name": "migration, party, candidates, attitudes, german federal election (T0), n=42", "lines": 4, "tooltip": ""}]}]}, {"id": "T50", "name": "democratic, competition, socio economic, germany, vignette experiment (T50), n=11", "lines": 4, "tooltip": ""}]}]}, {"id": "P95", "name": "social media_web tracking_behavioral_political knowledge_trust (n=144)", "lines": 3, "tooltip": "", "children": [{"id": "P91", "name": "management_facebook_web tracking_exposure_political knowledge (n=100)", "lines": 3, "tooltip": "", "children": [{"id": "P64", "name": "facebook_digital trace_linkage_reuse_social science (n=48)", "lines": 3, "tooltip": "", "children": [{"id": "T19", "name": "digital trace, sharing, disciplinary, vignette experiment, linkage (T19), n=20", "lines": 4, "tooltip": ""}, {"id": "T9", "name": "facebook, inclusion, social sciences, control, measurement invariance (T9), n=28", "lines": 4, "tooltip": ""}]}, {"id": "P80", "name": "web tracking_political knowledge_exposure_real_using (n=52)", "lines": 3, "tooltip": "", "children": [{"id": "P72", "name": "profile_memory_web tracking_prevalence_behavioral (n=24)", "lines": 3, "tooltip": "", "children": [{"id": "T39", "name": "web, functions, behavioral, temporal, satisfaction (T39), n=13", "lines": 3, "tooltip": ""}, {"id": "T48", "name": "profile, web tracking, germany, heterogeneous, health related (T48), n=11", "lines": 4, "tooltip": ""}]}, {"id": "P66", "name": "content_web tracking_political attitudes_detect_time (n=28)", "lines": 4, "tooltip": "", "children": [{"id": "T29", "name": "political knowledge, web tracking, immigration, actors, european union (T29), n=16", "lines": 4, "tooltip": ""}, {"id": "T44", "name": "exposure, time, computational social science, web tracking, registration (T44), n=12", "lines": 4, "tooltip": ""}]}]}]}, {"id": "P77", "name": "crisis_trust_social media_misinformation_election (n=44)", "lines": 3, "tooltip": "", "children": [{"id": "T49", "name": "search engines, familiarity, political science, open science, transformer (T49), n=11", "lines": 4, "tooltip": ""}, {"id": "P59", "name": "political_security_misinformation_social media_climate (n=33)", "lines": 2, "tooltip": "", "children": [{"id": "T16", "name": "security, misinformation, social media, climate, political parties (T16), n=22", "lines": 4, "tooltip": ""}, {"id": "T45", "name": "privacy, media, credibility, ethnic, perspective (T45), n=11", "lines": 3, "tooltip": ""}]}]}]}]}, {"id": "P97", "name": "differences_students_germany_personality_19 pandemic (n=372)", "lines": 2, "tooltip": "", "children": [{"id": "P52", "name": "19 pandemic_health_trust_cohort_classes (n=55)", "lines": 3, "tooltip": "", "children": [{"id": "T2", "name": "covid 19 pandemic, trust, cohort, invariance, social science (T2), n=36", "lines": 3, "tooltip": ""}, {"id": "T20", "name": "risk, children, 19 pandemic, life satisfaction, immigration (T20), n=19", "lines": 4, "tooltip": ""}]}, {"id": "P96", "name": "differences_violence_german_inequality_students (n=317)", "lines": 2, "tooltip": "", "children": [{"id": "P93", "name": "gender_violence_inequality_vocational_germany (n=182)", "lines": 2, "tooltip": "", "children": [{"id": "P84", "name": "violence_bias_women_speech_organizations (n=74)", "lines": 2, "tooltip": "", "children": [{"id": "T22", "name": "speech, cohorts, discrimination, computer science, career (T22), n=18", "lines": 4, "tooltip": ""}, {"id": "P76", "name": "violence_diversity_women_driving_age (n=56)", "lines": 2, "tooltip": "", "children": [{"id": "P70", "name": "violence_diversity_age_europe_higher education (n=38)", "lines": 2, "tooltip": "", "children": [{"id": "T18", "name": "acceptance, cohorts, younger, cross cultural, german (T18), n=20", "lines": 3, "tooltip": ""}, {"id": "T23", "name": "violence, europe, higher education, inequalities, women (T23), n=18", "lines": 3, "tooltip": ""}]}, {"id": "T24", "name": "gaps, domain, language models, women, training (T24), n=18", "lines": 3, "tooltip": ""}]}]}, {"id": "P90", "name": "family_personality_germany_welfare_class (n=108)", "lines": 2, "tooltip": "", "children": [{"id": "P55", "name": "personality_literacy_vocational_adolescents_differences (n=49)", "lines": 2, "tooltip": "", "children": [{"id": "T12", "name": "personality, vocational, matching, outcomes, state (T12), n=28", "lines": 3, "tooltip": ""}, {"id": "T17", "name": "literacy, adolescents, inequalities, emotional, categories (T17), n=21", "lines": 3, "tooltip": ""}]}, {"id": "P74", "name": "parental_welfare_germany_differences_labour (n=59)", "lines": 2, "tooltip": "", "children": [{"id": "P63", "name": "parental_germany_labour_inequality_migration (n=43)", "lines": 2, "tooltip": "", "children": [{"id": "T11", "name": "parental, germany, changing, socioeconomic, gaps (T11), n=28", "lines": 3, "tooltip": ""}, {"id": "T31", "name": "labour, migration, differences, couples, germany (T31), n=15", "lines": 3, "tooltip": ""}]}, {"id": "T30", "name": "welfare, crises, multilevel, factorial, europe (T30), n=16", "lines": 3, "tooltip": ""}]}]}]}, {"id": "P88", "name": "ended_questionnaire_german_parliamentary_uncertainty (n=135)", "lines": 2, "tooltip": "", "children": [{"id": "P83", "name": "uncertainty_belief_questionnaire_integrating_german language (n=44)", "lines": 2, "tooltip": "", "children": [{"id": "T8", "name": "uncertainty, adaptation, artificial intelligence, german language, comparability (T8), n=28", "lines": 4, "tooltip": ""}, {"id": "T27", "name": "questionnaire, multilingual, errors, machine, german (T27), n=16", "lines": 4, "tooltip": ""}]}, {"id": "P86", "name": "closed_elections_processes_german_level (n=91)", "lines": 2, "tooltip": "", "children": [{"id": "P71", "name": "closed_elections_quality_reduction_distributed (n=63)", "lines": 2, "tooltip": "", "children": [{"id": "T13", "name": "cognitive, loss, labels, pretesting, coding (T13), n=23", "lines": 3, "tooltip": ""}, {"id": "T1", "name": "elections, distributed, dimension, party, europe (T1), n=40", "lines": 3, "tooltip": ""}]}, {"id": "P81", "name": "chapter_war_east west germany_algorithms_differences (n=28)", "lines": 3, "tooltip": "", "children": [{"id": "T40", "name": "equivalence, regression, primary, performance, package (T40), n=13", "lines": 3, "tooltip": ""}, {"id": "T34", "name": "chapter, war, east west germany, changes, mental (T34), n=15", "lines": 3, "tooltip": ""}]}]}]}]}]}]}, {"id": "P78", "name": "mixed mode_recruitment_probability based_online panel_mail (n=81)", "lines": 4, "tooltip": "", "children": [{"id": "P68", "name": "recruitment_probability based_mixed mode_online panel_waves (n=58)", "lines": 3, "tooltip": "", "children": [{"id": "T26", "name": "interventions, recruitment, response behavior, testing, online panel (T26), n=17", "lines": 4, "tooltip": ""}, {"id": "P53", "name": "probability based_recruitment_mixed mode_online panel_waves (n=41)", "lines": 4, "tooltip": "", "children": [{"id": "T14", "name": "recruitment, online panel, probability based, mixed mode, mail (T14), n=23", "lines": 4, "tooltip": ""}, {"id": "T25", "name": "probability based, inclusion, mixed mode panel, waves, levels (T25), n=18", "lines": 4, "tooltip": ""}]}]}, {"id": "P56", "name": "face_mixed mode_panel_questionnaire_wave (n=23)", "lines": 3, "tooltip": "", "children": [{"id": "T47", "name": "panel, mixed mode, labor, attitudes, interviewer (T47), n=11", "lines": 3, "tooltip": ""}, {"id": "T43", "name": "interviewer, mixed mode, concurrent, self administered, rates (T43), n=12", "lines": 4, "tooltip": ""}]}]}]}]};
const collapsedDepth = 1;

const width = 1800;
const dx = 180;
const dy = 160;
const margin = {top: 20, left: 60};
const wrapWidth = 180;
const lineHeight = 14;

const root = d3.hierarchy(treeData);
root.x0 = 0;
root.y0 = 0;

function collapse(d) {
  if (d.children) {
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

root.descendants().forEach(d => {
  if (d.depth >= collapsedDepth) {
    collapse(d);
  }
});

const tree = d3.tree()
  .nodeSize([dx, dy])
  .separation((a, b) => {
    const la = a.data.lines || 1;
    const lb = b.data.lines || 1;
    const base = a.parent === b.parent ? 1 : 1.2;
    return base * Math.max(la, lb);
  });
const diagonal = d3.linkVertical().x(d => d.x).y(d => d.y);

const svg = d3.select("#chart").append("svg")
  .attr("width", width)
  .style("font", "12px sans-serif");

const gMain = svg.append("g");
const gLink = gMain.append("g").attr("class", "links");
const gNode = gMain.append("g").attr("class", "nodes");

function update(source) {
  const sourcePos = {x: (source.x0 ?? source.x), y: (source.y0 ?? source.y)};
  const nodes = root.descendants();
  const links = root.links();

  tree(root);

  let left = root;
  let right = root;
  root.eachBefore(node => {
    if (node.x < left.x) left = node;
    if (node.x > right.x) right = node;
  });

  const widthNeeded = right.x - left.x + dx * 4;
  const heightNeeded = root.height * dy + dy * 2;
  const svgWidth = Math.max(width, widthNeeded) + margin.left + 40;
  const svgHeight = heightNeeded + margin.top + 40;
  svg.attr("width", svgWidth).attr("height", svgHeight);
  gMain.attr("transform", `translate(${margin.left - left.x + dx * 2},${margin.top})`);

  const node = gNode.selectAll("g").data(nodes, d => d.id);

  const nodeEnter = node.enter().append("g")
    .attr("class", "node")
    .attr("transform", d => `translate(${sourcePos.x},${sourcePos.y})`)
    .on("click", (event, d) => {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
      update(d);
    });

  nodeEnter.append("circle")
    .attr("r", 5);

  const label = nodeEnter.append("text")
    .attr("dy", "0.31em")
    .attr("x", d => d.children || d._children ? -10 : 10)
    .attr("text-anchor", d => d.children || d._children ? "end" : "start")
    .text(d => d.data.name);

  label.call(wrap, wrapWidth);
  label.clone(true).lower().attr("stroke", "white");

  nodeEnter.append("text")
    .attr("class", "toggle")
    .attr("dy", "0.31em")
    .attr("x", -2)
    .attr("text-anchor", "middle")
    .text(d => d._children ? "+" : d.children ? "-" : "");

  nodeEnter.append("title").text(d => d.data.tooltip || d.data.name);

  const nodeUpdate = nodeEnter.merge(node);
  nodeUpdate.transition().duration(250)
    .attr("transform", d => `translate(${d.x},${d.y})`);

  nodeUpdate.select("text.toggle")
    .text(d => d._children ? "+" : d.children ? "-" : "");

  const nodeExit = node.exit().transition().duration(250)
    .attr("transform", d => `translate(${sourcePos.x},${sourcePos.y})`)
    .remove();

  nodeExit.select("circle").attr("r", 0);

  const link = gLink.selectAll("path").data(links, d => d.target.id);

  const linkEnter = link.enter().append("path")
    .attr("class", "link")
    .attr("d", d => {
      const o = {x: sourcePos.x, y: sourcePos.y};
      return diagonal({source: o, target: o});
    });

  linkEnter.merge(link).transition().duration(250)
    .attr("d", diagonal);

  link.exit().transition().duration(250)
    .attr("d", d => {
      const o = {x: sourcePos.x, y: sourcePos.y};
      return diagonal({source: o, target: o});
    })
    .remove();

  root.eachBefore(d => {
    d.x0 = d.x;
    d.y0 = d.y;
  });
}

update(root);

function wrap(text, width) {
  text.each(function() {
    const text = d3.select(this);
    const words = text.text().split(/\s+/).reverse();
    let word;
    let line = [];
    let lineNumber = 0;
    const x = text.attr("x");
    const y = text.attr("y");
    const dyText = parseFloat(text.attr("dy")) || 0;
    let tspan = text.text(null).append("tspan")
      .attr("x", x)
      .attr("y", y)
      .attr("dy", dyText + "em");

    while ((word = words.pop())) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text.append("tspan")
          .attr("x", x)
          .attr("y", y)
          .attr("dy", (lineNumber + 1) * (lineHeight / 12) + "em")
          .text(word);
        lineNumber += 1;
      }
    }
  });
}
</script>
</body>
</html>
